<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-calymer-events">
    <template>
        <style include="shared-styles">
            :host {
                display: block
            }

            a {
                color: blue;
                text-decoration: none;
            }

            h2 {
                color:var(--paper-green-500); 
            }

            paper-dialog.size-position {
                position: fixed;
                top: 16px;
                right: 16px;
                width: 300px;
                height: 300px;
                overflow: auto;
            }

            paper-button.green {
                background-color: red;
                color: white;
            }
            
        </style>

    <iron-ajax
        auto
        url='http://localhost:3000/events'
        last-response="{{ events }}" >
    </iron-ajax>

    <iron-ajax
        id="deleteEvent"
        method="delete"
        url='http://localhost:3000/events/[[id]]'
        on-response="deleteEventResponse"
        on-error="deleteEventError">
    </iron-ajax>

        <paper-dialog id="dialog">
            <p>Â¿Seguro que quieres borrar este evento?</p>
            <paper-button on-click="deleteEvent">Aceptar</paper-button>
            <paper-button on-click="cancelDelete">Cancelar</paper-button>
        </paper-dialog>

    <div class="card">
        <template is="dom-repeat" items="[[ events ]]" as="event">
            <h2>[[ event.name ]]</h2>
            <p>[[ event.description ]]</p>
            <a href$="/update-event/[[event.id]]">Update event</a>
            <paper-button toggles raised class="custom green" on-click="dialogOpen" id="[[event.id]]">Delete event</paper-button>
            <hr>
        </template>
    </div>

    </template>

    <script>
        
        class MyCalymerEvents extends Polymer.Element {
            
            static get is() {
                return 'my-calymer-events';
            }

           
            static get properties() {
                return {
                    events: Array,
                    id: Number
                };
            }

            dialogOpen (e) {
                const id = e.target.getAttribute('id')
                this.id = id
                this.$.dialog.open()
            }

            cancelDelete () {
                this.$.dialog.close()
            }

            deleteEvent() {
                this.$.deleteEvent.generateRequest()
                this.$.dialog.close()
            }

            deleteEventResponse() {
               console.log('event deleted')
            }

            deleteEventError(error) {
               console.log('There was an error deleting the event', error.detail.error)
            }

        }

        window.customElements.define(MyCalymerEvents.is, MyCalymerEvents);
    </script>
</dom-module>